sudo: required
services:
  - docker

before_install:
  - docker build -t 307949230/client-test -f ./client/Dockerfile.dev ./client

script:
  - docker run 307949230/client-test npm test -- --coverage

after_success:
  # # Log in to the docker CLI
  # - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_ID" --password-stdin
  # # Take those images and push them to docker hub
  # - docker push 307949230/mern-client
  # - docker push 307949230/mern-nginx
  # - docker push 307949230/mern-server
  # -  restart --app my-heroku-app-name # requires HEROKU_API_KEY env variable
  - wget -qO- https://toolbelt.heroku.com/install.sh | sh
  - docker login -u _ -p "$HEROKU_API_KEY" registry.heroku.com
  # - docker build -t 307949230/mern-client ./client
  # - docker build -t 307949230/mern-nginx ./nginx
  # - docker build -t 307949230/mern-server ./server
  # - docker login --username=_ --password=$(heroku auth:token) registry.heroku.com
  - /usr/local/heroku/bin/heroku container:push nginx server client --recursive
  - /usr/local/heroku/bin/heroku container:release nginx server client
  # - heroku run bash --type=nginx
  # - heroku run bash --type=server
  # - heroku run bash --type=client
